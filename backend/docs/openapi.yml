openapi: 3.0.3
info:
  title: COLOR03 åƒç´ ç”»è½¬æ¢ API
  description: |
    COLOR03 åƒç´ ç”»è½¬æ¢ API æä¾›äº†å®Œæ•´çš„å›¾åƒåˆ°åƒç´ ç”»è½¬æ¢æœåŠ¡ï¼Œæ”¯æŒå¤šç§æ’å€¼ç®—æ³•ã€é¢œè‰²é‡åŒ–æ–¹æ³•å’ŒæŠ–åŠ¨å¤„ç†ã€‚
    
    ## ä¸»è¦ç‰¹æ€§
    - ğŸ¨ å¤šç§æ’å€¼ç®—æ³•ï¼ˆæœ€è¿‘é‚»ã€åŒçº¿æ€§ï¼‰
    - ğŸŒˆ é«˜çº§é¢œè‰²é‡åŒ–ï¼ˆå…«å‰æ ‘ã€K-meansï¼‰
    - âœ¨ ä¸“ä¸šæŠ–åŠ¨å¤„ç†ï¼ˆBayerçŸ©é˜µã€Floyd-Steinbergï¼‰
    - ğŸš€ æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†
    - ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
    
  version: 1.0.0
  contact:
    name: ColorMagic Team
    url: https://github.com/colormagic/pixel-art-api
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3001/api/color03
    description: å¼€å‘ç¯å¢ƒ
  - url: https://api.colormagic.com/color03
    description: ç”Ÿäº§ç¯å¢ƒ

paths:
  /health:
    get:
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€å’Œå¯ç”¨æ€§
      operationId: healthCheck
      tags:
        - ç³»ç»Ÿç›‘æ§
      responses:
        '200':
          description: æœåŠ¡å¥åº·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
              example:
                success: true
                status: "healthy"
                timestamp: "2024-01-20T10:30:00.000Z"
                checkId: "health_1641823800000"
                services:
                  sharp:
                    status: true
                    error: null
                  memory:
                    status: true
                    warning: false
                    usage:
                      heapUsed: "45.67MB"
                      heapTotal: "89.23MB"
                      external: "12.34MB"
                      rss: "156.78MB"
                  uptime:
                    status: true
                    minutes: "123.45"
        '503':
          description: æœåŠ¡ä¸å¯ç”¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pixel-art/convert:
    post:
      summary: åƒç´ ç”»è½¬æ¢
      description: å°†ä¸Šä¼ çš„å›¾åƒè½¬æ¢ä¸ºåƒç´ ç”»
      operationId: convertToPixelArt
      tags:
        - å›¾åƒå¤„ç†
      parameters:
        - name: quality
          in: query
          description: å¤„ç†è´¨é‡çº§åˆ«
          required: false
          schema:
            type: string
            enum: [fast, balanced, high_quality]
            default: balanced
          example: balanced
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - imageFile
                - resizeFactor
                - interpolation
                - colorMode
                - ditheringRatio
              properties:
                imageFile:
                  type: string
                  format: binary
                  description: å›¾åƒæ–‡ä»¶ (PNG/JPG/JPEG, æœ€å¤§10MB)
                resizeFactor:
                  type: number
                  minimum: 0
                  maximum: 100
                  description: ç¼©æ”¾å› å­ (0-100)
                  example: 25
                interpolation:
                  type: string
                  enum: [nearest_neighbor, bilinear]
                  description: æ’å€¼æ–¹æ³•
                  example: nearest_neighbor
                colorMode:
                  type: string
                  enum: [no_dithering, ordered_dithering_bayer]
                  description: é¢œè‰²æ¨¡å¼
                  example: ordered_dithering_bayer
                ditheringRatio:
                  type: number
                  minimum: 0.1
                  maximum: 3.0
                  description: æŠ–åŠ¨æ¯”ä¾‹ (0.1-3.0)
                  example: 1.5
            encoding:
              imageFile:
                contentType: image/png, image/jpeg, image/jpg
      responses:
        '200':
          description: è½¬æ¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversionSuccessResponse'
              example:
                success: true
                data:
                  pixelArtImage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
                  canvasInfo:
                    width: 64
                    height: 48
                    coloredPixels: 3072
                  extractedColors:
                    - "#FF0000"
                    - "#00FF00"
                    - "#0000FF"
                    - "#FFFFFF"
                    - "#000000"
                  processingTime: 1250.67
                  requestId: "req_1641823800000_abc123def"
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_error:
                  summary: å‚æ•°éªŒè¯é”™è¯¯
                  value:
                    success: false
                    error: "è¾“å…¥å‚æ•°æœ‰è¯¯ï¼Œå»ºè®®ï¼šæ£€æŸ¥è¾“å…¥å‚æ•°èŒƒå›´"
                    code: "VALIDATION_ERROR"
                    suggestions:
                      - "æ£€æŸ¥è¾“å…¥å‚æ•°èŒƒå›´"
                      - "éªŒè¯å¿…éœ€å‚æ•°"
                      - "ä½¿ç”¨é»˜è®¤å‚æ•°é‡è¯•"
                image_too_large:
                  summary: å›¾åƒè¿‡å¤§
                  value:
                    success: false
                    error: "å›¾åƒå°ºå¯¸è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ 4096x4096 åƒç´ "
                    code: "IMAGE_TOO_LARGE"
                    suggestions:
                      - "ä½¿ç”¨æ›´å°çš„å›¾åƒ"
                      - "è£å‰ªå›¾åƒåˆ°æ”¯æŒçš„å°ºå¯¸"
        '408':
          description: å¤„ç†è¶…æ—¶
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: æ–‡ä»¶è¿‡å¤§æˆ–å†…å­˜ä¸è¶³
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "å†…å­˜ä¸è¶³ï¼Œå»ºè®®ï¼šå¯ç”¨åˆ†å—å¤„ç†æ¨¡å¼"
                code: "MEMORY_LIMIT_EXCEEDED"
                suggestions:
                  - "å¯ç”¨åˆ†å—å¤„ç†æ¨¡å¼"
                  - "å‡å°‘å›¾åƒå°ºå¯¸"
                  - "é™ä½é¢œè‰²æ•°é‡"
        '422':
          description: å¤„ç†å¤±è´¥
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    HealthCheckResponse:
      type: object
      required:
        - success
        - status
        - timestamp
        - checkId
      properties:
        success:
          type: boolean
          description: è¯·æ±‚æ˜¯å¦æˆåŠŸ
        status:
          type: string
          enum: [healthy, unhealthy, error]
          description: æœåŠ¡çŠ¶æ€
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´æˆ³
        checkId:
          type: string
          description: æ£€æŸ¥ID
        services:
          type: object
          description: å„æœåŠ¡çŠ¶æ€è¯¦æƒ…
          properties:
            sharp:
              type: object
              properties:
                status:
                  type: boolean
                error:
                  type: string
                  nullable: true
            memory:
              type: object
              properties:
                status:
                  type: boolean
                warning:
                  type: boolean
                usage:
                  type: object
                  properties:
                    heapUsed:
                      type: string
                    heapTotal:
                      type: string
                    external:
                      type: string
                    rss:
                      type: string
            uptime:
              type: object
              properties:
                status:
                  type: boolean
                minutes:
                  type: string
        detailed:
          type: object
          description: è¯¦ç»†ç³»ç»Ÿä¿¡æ¯
          properties:
            memory:
              type: object
              description: è¯¦ç»†å†…å­˜ä½¿ç”¨ä¿¡æ¯
            uptime:
              type: string
            nodeVersion:
              type: string
            platform:
              type: string
            arch:
              type: string

    ConversionSuccessResponse:
      type: object
      required:
        - success
        - data
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          required:
            - pixelArtImage
            - canvasInfo
            - extractedColors
            - processingTime
            - requestId
          properties:
            pixelArtImage:
              type: string
              description: Base64ç¼–ç çš„PNGå›¾åƒ
              example: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
            canvasInfo:
              type: object
              required:
                - width
                - height
                - coloredPixels
              properties:
                width:
                  type: integer
                  description: è¾“å‡ºå›¾åƒå®½åº¦
                  example: 64
                height:
                  type: integer
                  description: è¾“å‡ºå›¾åƒé«˜åº¦
                  example: 48
                coloredPixels:
                  type: integer
                  description: æœ‰é¢œè‰²çš„åƒç´ æ•°é‡
                  example: 3072
            extractedColors:
              type: array
              items:
                type: string
                pattern: '^#[0-9A-Fa-f]{6}$'
              description: æå–çš„è°ƒè‰²æ¿é¢œè‰²æ•°ç»„
              example: ["#FF0000", "#00FF00", "#0000FF"]
            processingTime:
              type: number
              description: å¤„ç†æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
              example: 1250.67
            requestId:
              type: string
              description: è¯·æ±‚è¿½è¸ªID
              example: "req_1641823800000_abc123def"

    ErrorResponse:
      type: object
      required:
        - success
        - error
        - code
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
          example: "å›¾åƒå°ºå¯¸è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ 4096x4096 åƒç´ "
        code:
          type: string
          description: é”™è¯¯ä»£ç 
          enum:
            - VALIDATION_ERROR
            - INVALID_IMAGE_CONTENT
            - IMAGE_TOO_LARGE
            - IMAGE_TOO_MANY_PIXELS
            - MEMORY_LIMIT_EXCEEDED
            - PROCESSING_TIMEOUT
            - CONVERSION_FAILED
            - INTERNAL_ERROR
          example: "IMAGE_TOO_LARGE"
        suggestions:
          type: array
          items:
            type: string
          description: è§£å†³å»ºè®®
          example:
            - "ä½¿ç”¨æ›´å°çš„å›¾åƒ"
            - "è£å‰ªå›¾åƒåˆ°æ”¯æŒçš„å°ºå¯¸"
        requestId:
          type: string
          description: è¯·æ±‚è¿½è¸ªID
          example: "req_1641823800000_abc123def"

  examples:
    BasicConversionRequest:
      summary: åŸºç¡€è½¬æ¢è¯·æ±‚
      description: ä½¿ç”¨æœ€è¿‘é‚»æ’å€¼å’Œæ— æŠ–åŠ¨çš„åŸºç¡€åƒç´ ç”»è½¬æ¢
      value:
        resizeFactor: 25
        interpolation: "nearest_neighbor"
        colorMode: "no_dithering"
        ditheringRatio: 1.0

    HighQualityConversionRequest:
      summary: é«˜è´¨é‡è½¬æ¢è¯·æ±‚
      description: ä½¿ç”¨åŒçº¿æ€§æ’å€¼å’ŒBayerçŸ©é˜µæŠ–åŠ¨çš„é«˜è´¨é‡è½¬æ¢
      value:
        resizeFactor: 50
        interpolation: "bilinear"
        colorMode: "ordered_dithering_bayer"
        ditheringRatio: 2.0

tags:
  - name: å›¾åƒå¤„ç†
    description: åƒç´ ç”»è½¬æ¢ç›¸å…³API
  - name: ç³»ç»Ÿç›‘æ§
    description: æœåŠ¡çŠ¶æ€ç›‘æ§API

externalDocs:
  description: å®Œæ•´APIæ–‡æ¡£
  url: ./API_SPECIFICATION.md

