# æ¨¡å—åŒ–åŠŸèƒ½é¡µé¢å¿«é€Ÿæ¥å…¥æŒ‡å—

> **åŸºäºæ–¹æ¡ˆAï¼šæ¨¡å—åŒ–è·¯ç”±æ¥å…¥çš„æ ‡å‡†åŒ–æµç¨‹**  
> **é€‚ç”¨äºå‰åç«¯åˆ†ç¦»æ¶æ„ (React + Express)**  
> **ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-03

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [æ¨¡å—ç»“æ„è§„èŒƒ](#æ¨¡å—ç»“æ„è§„èŒƒ)
3. [å‰ç«¯æ¥å…¥æµç¨‹](#å‰ç«¯æ¥å…¥æµç¨‹)
4. [åç«¯æ¥å…¥æµç¨‹](#åç«¯æ¥å…¥æµç¨‹)
5. [é…ç½®å’Œæ³¨å†Œ](#é…ç½®å’Œæ³¨å†Œ)
6. [éƒ¨ç½²å’ŒéªŒè¯](#éƒ¨ç½²å’ŒéªŒè¯)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ ¸å¿ƒåŸåˆ™

```
âŒ ä¸ä½¿ç”¨404é¡µé¢ä½œä¸ºåŠŸèƒ½å…¥å£
âœ… ä½¿ç”¨æ¨¡å—åŒ–è·¯ç”±é…ç½® + åŠ¨æ€æ³¨å†Œ
âœ… å‰ç«¯React Router + åç«¯Express Router
âœ… ç»Ÿä¸€çš„æ¨¡å—é…ç½®å’Œç®¡ç†
```

### 5åˆ†é’Ÿå¿«é€Ÿæ¥å…¥

```bash
# 1. åˆ›å»ºæ¨¡å—ï¼ˆä½¿ç”¨è„šæœ¬ï¼‰
./scripts/create-new-module.sh my-feature

# 2. ç¼–å†™åŠŸèƒ½ä»£ç 
# - frontend/pages/MyFeaturePage.tsx
# - backend/routes/myFeatureRoutes.ts

# 3. æ³¨å†Œæ¨¡å—
# - ç¼–è¾‘ template-config/module.registry.ts

# 4. éƒ¨ç½²
npm run build && ./scripts/one-click-deploy.sh
```

---

## ğŸ“ æ¨¡å—ç»“æ„è§„èŒƒ

### æ ‡å‡†æ¨¡å—ç›®å½•ç»“æ„

```
modules/
â””â”€â”€ {module-name}/              # æ¨¡å—åç§°ï¼ˆå°å†™ï¼Œç”¨è¿å­—ç¬¦åˆ†éš”ï¼‰
    â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç 
    â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ {ModuleName}Page.tsx
    â”‚   â”œâ”€â”€ components/        # æ¨¡å—ä¸“ç”¨ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ {ComponentName}.tsx
    â”‚   â”œâ”€â”€ hooks/             # æ¨¡å—ä¸“ç”¨Hooks
    â”‚   â”‚   â””â”€â”€ use{Feature}.ts
    â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹å®šä¹‰
    â”‚   â”‚   â””â”€â”€ index.ts
    â”‚   â””â”€â”€ styles/            # æ¨¡å—æ ·å¼ï¼ˆå¯é€‰ï¼‰
    â”‚       â””â”€â”€ {module}.css
    â”‚
    â”œâ”€â”€ backend/               # åç«¯ä»£ç 
    â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
    â”‚   â”‚   â””â”€â”€ {module}Routes.ts
    â”‚   â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨
    â”‚   â”‚   â””â”€â”€ {module}Controller.ts
    â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
    â”‚   â”‚   â””â”€â”€ {module}Service.ts
    â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚   â””â”€â”€ {module}Middleware.ts
    â”‚   â””â”€â”€ types/             # TypeScriptç±»å‹
    â”‚       â””â”€â”€ index.ts
    â”‚
    â”œâ”€â”€ database/              # æ•°æ®åº“è„šæœ¬ï¼ˆå¯é€‰ï¼‰
    â”‚   â””â”€â”€ {module}_tables.sql
    â”‚
    â”œâ”€â”€ i18n/                  # å›½é™…åŒ–ï¼ˆå¯é€‰ï¼‰
    â”‚   â””â”€â”€ locales/
    â”‚       â”œâ”€â”€ zh.json
    â”‚       â”œâ”€â”€ en.json
    â”‚       â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ module.config.ts       # â­ æ¨¡å—é…ç½®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
    â””â”€â”€ README.md             # æ¨¡å—è¯´æ˜æ–‡æ¡£
```

### æ¨¡å—å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åè§„åˆ™ | ç¤ºä¾‹ |
|------|---------|------|
| æ¨¡å—ç›®å½• | kebab-case | `user-profile`, `color-analysis` |
| å‰ç«¯é¡µé¢ç»„ä»¶ | PascalCase + Page | `UserProfilePage.tsx` |
| åç«¯è·¯ç”±æ–‡ä»¶ | camelCase + Routes | `userProfileRoutes.ts` |
| APIè·¯å¾„ | kebab-case | `/api/user-profile` |
| å‰ç«¯è·¯ç”±è·¯å¾„ | kebab-case | `/user-profile` |

---

## ğŸ¨ å‰ç«¯æ¥å…¥æµç¨‹

### æ­¥éª¤1: åˆ›å»ºé¡µé¢ç»„ä»¶

```typescript
// modules/my-feature/frontend/pages/MyFeaturePage.tsx
import React from 'react'
import { useTranslation } from 'react-i18next'
import { useNavigate } from 'react-router-dom'

export const MyFeaturePage: React.FC = () => {
  const { t } = useTranslation()
  const navigate = useNavigate()

  return (
    <div className="my-feature-page">
      <h1>{t('myFeature.title')}</h1>
      <p>{t('myFeature.description')}</p>
      
      {/* åŠŸèƒ½å®ç° */}
      <div className="feature-content">
        {/* ... */}
      </div>

      <button onClick={() => navigate('/')}>
        {t('common.backToHome')}
      </button>
    </div>
  )
}
```

### æ­¥éª¤2: åˆ›å»ºæ¨¡å—ä¸“ç”¨ç»„ä»¶ï¼ˆå¯é€‰ï¼‰

```typescript
// modules/my-feature/frontend/components/FeatureCard.tsx
import React from 'react'

interface FeatureCardProps {
  title: string
  description: string
  onClick?: () => void
}

export const FeatureCard: React.FC<FeatureCardProps> = ({
  title,
  description,
  onClick
}) => {
  return (
    <div className="feature-card" onClick={onClick}>
      <h3>{title}</h3>
      <p>{description}</p>
    </div>
  )
}
```

### æ­¥éª¤3: åˆ›å»ºç±»å‹å®šä¹‰

```typescript
// modules/my-feature/frontend/types/index.ts
export interface FeatureData {
  id: string
  title: string
  content: string
  createdAt: Date
  updatedAt?: Date
}

export interface FeatureResponse {
  success: boolean
  data: FeatureData
  message?: string
}
```

### æ­¥éª¤4: åˆ›å»ºAPIè°ƒç”¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰

```typescript
// modules/my-feature/frontend/services/featureService.ts
import axios from 'axios'
import type { FeatureData, FeatureResponse } from '../types'

const API_BASE = '/api/my-feature'

export const featureService = {
  // è·å–æ•°æ®
  async getData(id: string): Promise<FeatureData> {
    const response = await axios.get<FeatureResponse>(`${API_BASE}/${id}`)
    return response.data.data
  },

  // åˆ›å»ºæ•°æ®
  async createData(data: Partial<FeatureData>): Promise<FeatureData> {
    const response = await axios.post<FeatureResponse>(API_BASE, data)
    return response.data.data
  },

  // æ›´æ–°æ•°æ®
  async updateData(id: string, data: Partial<FeatureData>): Promise<FeatureData> {
    const response = await axios.put<FeatureResponse>(`${API_BASE}/${id}`, data)
    return response.data.data
  },

  // åˆ é™¤æ•°æ®
  async deleteData(id: string): Promise<void> {
    await axios.delete(`${API_BASE}/${id}`)
  }
}
```

---

## ğŸ”§ åç«¯æ¥å…¥æµç¨‹

### æ­¥éª¤1: åˆ›å»ºè·¯ç”±æ–‡ä»¶

```typescript
// modules/my-feature/backend/routes/myFeatureRoutes.ts
import express from 'express'
import { myFeatureController } from '../controllers/myFeatureController'
import { authMiddleware } from '../../../backend/src/middleware/auth'

const router = express.Router()

// å…¬å¼€è·¯ç”±
router.get('/public', myFeatureController.getPublicData)

// å—ä¿æŠ¤è·¯ç”±ï¼ˆéœ€è¦è®¤è¯ï¼‰
router.use(authMiddleware) // æ‰€æœ‰åç»­è·¯ç”±éœ€è¦è®¤è¯

router.get('/:id', myFeatureController.getData)
router.post('/', myFeatureController.createData)
router.put('/:id', myFeatureController.updateData)
router.delete('/:id', myFeatureController.deleteData)

export default router
```

### æ­¥éª¤2: åˆ›å»ºæ§åˆ¶å™¨

```typescript
// modules/my-feature/backend/controllers/myFeatureController.ts
import { Request, Response } from 'express'
import { myFeatureService } from '../services/myFeatureService'

export const myFeatureController = {
  // è·å–æ•°æ®
  async getData(req: Request, res: Response) {
    try {
      const { id } = req.params
      const data = await myFeatureService.getData(id)
      
      res.json({
        success: true,
        data,
        message: 'è·å–æˆåŠŸ'
      })
    } catch (error) {
      res.status(500).json({
        success: false,
        message: error.message
      })
    }
  },

  // åˆ›å»ºæ•°æ®
  async createData(req: Request, res: Response) {
    try {
      const userId = req.user?.id // ä»è®¤è¯ä¸­é—´ä»¶è·å–
      const data = await myFeatureService.createData({
        ...req.body,
        userId
      })
      
      res.status(201).json({
        success: true,
        data,
        message: 'åˆ›å»ºæˆåŠŸ'
      })
    } catch (error) {
      res.status(500).json({
        success: false,
        message: error.message
      })
    }
  },

  // æ›´æ–°æ•°æ®
  async updateData(req: Request, res: Response) {
    try {
      const { id } = req.params
      const data = await myFeatureService.updateData(id, req.body)
      
      res.json({
        success: true,
        data,
        message: 'æ›´æ–°æˆåŠŸ'
      })
    } catch (error) {
      res.status(500).json({
        success: false,
        message: error.message
      })
    }
  },

  // åˆ é™¤æ•°æ®
  async deleteData(req: Request, res: Response) {
    try {
      const { id } = req.params
      await myFeatureService.deleteData(id)
      
      res.json({
        success: true,
        message: 'åˆ é™¤æˆåŠŸ'
      })
    } catch (error) {
      res.status(500).json({
        success: false,
        message: error.message
      })
    }
  },

  // å…¬å¼€æ¥å£
  async getPublicData(req: Request, res: Response) {
    try {
      const data = await myFeatureService.getPublicData()
      res.json({ success: true, data })
    } catch (error) {
      res.status(500).json({ success: false, message: error.message })
    }
  }
}
```

### æ­¥éª¤3: åˆ›å»ºæœåŠ¡å±‚

```typescript
// modules/my-feature/backend/services/myFeatureService.ts
import { databaseService } from '../../../backend/src/services/database/databaseServiceFactory'
import { AUTH_TABLES } from '../../../backend/src/config/tables'

// æ¨¡å—è¡¨åï¼ˆä½¿ç”¨TABLE_PREFIXï¼‰
const TABLE_PREFIX = process.env.TABLE_PREFIX || ''
const FEATURE_TABLE = `${TABLE_PREFIX}my_feature_data`

export const myFeatureService = {
  async getData(id: string) {
    const query = `
      SELECT * FROM ${FEATURE_TABLE}
      WHERE id = $1
    `
    const result = await databaseService.query(query, [id])
    
    if (result.rows.length === 0) {
      throw new Error('æ•°æ®ä¸å­˜åœ¨')
    }
    
    return result.rows[0]
  },

  async createData(data: any) {
    const query = `
      INSERT INTO ${FEATURE_TABLE} (title, content, user_id, created_at)
      VALUES ($1, $2, $3, NOW())
      RETURNING *
    `
    const result = await databaseService.query(query, [
      data.title,
      data.content,
      data.userId
    ])
    
    return result.rows[0]
  },

  async updateData(id: string, data: any) {
    const query = `
      UPDATE ${FEATURE_TABLE}
      SET title = $1, content = $2, updated_at = NOW()
      WHERE id = $3
      RETURNING *
    `
    const result = await databaseService.query(query, [
      data.title,
      data.content,
      id
    ])
    
    if (result.rows.length === 0) {
      throw new Error('æ•°æ®ä¸å­˜åœ¨')
    }
    
    return result.rows[0]
  },

  async deleteData(id: string) {
    const query = `DELETE FROM ${FEATURE_TABLE} WHERE id = $1`
    await databaseService.query(query, [id])
  },

  async getPublicData() {
    const query = `
      SELECT id, title, created_at 
      FROM ${FEATURE_TABLE}
      WHERE is_public = true
      ORDER BY created_at DESC
      LIMIT 10
    `
    const result = await databaseService.query(query, [])
    return result.rows
  }
}
```

### æ­¥éª¤4: åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆå¯é€‰ï¼‰

```sql
-- modules/my-feature/database/myfeature_tables.sql

-- ä½¿ç”¨è¡¨å‰ç¼€ï¼ˆä»ç¯å¢ƒå˜é‡è·å–ï¼‰
-- å®é™…éƒ¨ç½²æ—¶ä¼šæ›¿æ¢ä¸ºï¼šsite3__my_feature_data

CREATE TABLE IF NOT EXISTS {TABLE_PREFIX}my_feature_data (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES {TABLE_PREFIX}users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    is_public BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_myfeature_user ON {TABLE_PREFIX}my_feature_data(user_id);
CREATE INDEX idx_myfeature_public ON {TABLE_PREFIX}my_feature_data(is_public, created_at);

-- æˆäºˆç«™ç‚¹ç”¨æˆ·æƒé™
GRANT ALL PRIVILEGES ON {TABLE_PREFIX}my_feature_data TO {SITE_USER};
GRANT USAGE, SELECT ON SEQUENCE {TABLE_PREFIX}my_feature_data_id_seq TO {SITE_USER};
```

---

## âš™ï¸ é…ç½®å’Œæ³¨å†Œ

### æ­¥éª¤1: åˆ›å»ºæ¨¡å—é…ç½®æ–‡ä»¶

```typescript
// modules/my-feature/module.config.ts
import { ModuleConfig } from '../../template-config/types'
import myFeatureRoutes from './backend/routes/myFeatureRoutes'

const myFeatureConfig: ModuleConfig = {
  // åŸºæœ¬ä¿¡æ¯
  id: 'my-feature',
  name: 'æˆ‘çš„åŠŸèƒ½æ¨¡å—',
  description: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹åŠŸèƒ½æ¨¡å—',
  version: '1.0.0',
  author: 'Your Name',
  
  // å‰ç«¯è·¯ç”±é…ç½®
  routes: [
    {
      path: '/my-feature',
      component: () => import('./frontend/pages/MyFeaturePage'),
      meta: {
        requireAuth: false,  // æ˜¯å¦éœ€è¦è®¤è¯
        title: 'æˆ‘çš„åŠŸèƒ½',
        icon: 'feature-icon'
      }
    },
    {
      path: '/my-feature/:id',
      component: () => import('./frontend/pages/MyFeatureDetailPage'),
      meta: {
        requireAuth: true,
        title: 'åŠŸèƒ½è¯¦æƒ…'
      }
    }
  ],
  
  // åç«¯è·¯ç”±
  backendRoutes: myFeatureRoutes,
  
  // APIè·¯å¾„å‰ç¼€
  apiPrefix: '/api/my-feature',
  
  // æ•°æ®åº“è¡¨é…ç½®
  database: {
    tables: ['my_feature_data'],
    initScript: './database/myfeature_tables.sql'
  },
  
  // å›½é™…åŒ–é…ç½®
  i18n: {
    namespaces: ['myFeature'],
    locales: ['zh', 'en', 'ja', 'ko']
  },
  
  // æƒé™é…ç½®ï¼ˆå¯é€‰ï¼‰
  permissions: {
    read: 'my-feature:read',
    write: 'my-feature:write',
    delete: 'my-feature:delete'
  },
  
  // ä¾èµ–çš„å…¶ä»–æ¨¡å—ï¼ˆå¯é€‰ï¼‰
  dependencies: [],
  
  // å…³é”®è¯ï¼ˆç”¨äºæœç´¢å’Œæ¨èï¼‰
  keywords: ['feature', 'example', 'åŠŸèƒ½', 'ç¤ºä¾‹'],
  
  // æ˜¯å¦å¯ç”¨
  enabled: true
}

export default myFeatureConfig
```

### æ­¥éª¤2: æ³¨å†Œåˆ°æ¨¡å—æ³¨å†Œå™¨

```typescript
// template-config/module.registry.ts
import exampleSimpleConfig from '../modules/example-simple/module.config'
import colorAnalysisConfig from '../modules/color-analysis/module.config'
import myFeatureConfig from '../modules/my-feature/module.config'  // å¯¼å…¥æ–°æ¨¡å—

export class ModuleRegistry {
  // å¯ç”¨æ¨¡å—æ˜ å°„
  static availableModules = new Map<string, ModuleConfig>([
    ['example-simple', exampleSimpleConfig],
    ['color-analysis', colorAnalysisConfig],
    ['my-feature', myFeatureConfig],  // â­ æ³¨å†Œæ–°æ¨¡å—
  ])
  
  // æ¿€æ´»çš„æ¨¡å—åˆ—è¡¨
  static activeModules: string[] = [
    'example-simple',
    'color-analysis',
    'my-feature',  // â­ æ¿€æ´»æ–°æ¨¡å—
  ]
  
  // è·å–æ‰€æœ‰æ¿€æ´»çš„æ¨¡å—é…ç½®
  static getActiveModules(): ModuleConfig[] {
    return this.activeModules
      .map(name => this.availableModules.get(name))
      .filter(config => config?.enabled)
  }
  
  // è·å–æ¨¡å—è·¯ç”±
  static getModuleRoutes() {
    const routes = []
    
    this.getActiveModules().forEach(config => {
      if (config.routes) {
        routes.push(...config.routes)
      }
    })
    
    return routes
  }
  
  // è·å–æ¨¡å—APIè·¯ç”±
  static getModuleApiRoutes() {
    const apiRoutes = new Map()
    
    this.getActiveModules().forEach(config => {
      if (config.backendRoutes) {
        apiRoutes.set(config.apiPrefix, config.backendRoutes)
      }
    })
    
    return apiRoutes
  }
}
```

### æ­¥éª¤3: å‰ç«¯Appé›†æˆ

```typescript
// frontend/src/App.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import { ModuleRegistry } from '../template-config/module.registry'
import { Suspense, lazy } from 'react'

// æ ¸å¿ƒé¡µé¢
import HomePage from './pages/HomePage'
import NotFoundPage from './pages/NotFoundPage'

// æ‡’åŠ è½½æ¨¡å—é¡µé¢
const loadModuleComponent = (importFn: () => Promise<any>) => {
  return lazy(importFn)
}

function App() {
  // è·å–æ‰€æœ‰æ¨¡å—è·¯ç”±
  const moduleRoutes = ModuleRegistry.getModuleRoutes()

  return (
    <BrowserRouter>
      <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
        <Routes>
          {/* æ ¸å¿ƒè·¯ç”± */}
          <Route path="/" element={<HomePage />} />
          
          {/* åŠ¨æ€åŠ è½½æ¨¡å—è·¯ç”± */}
          {moduleRoutes.map(route => {
            const Component = loadModuleComponent(route.component)
            
            return (
              <Route
                key={route.path}
                path={route.path}
                element={
                  route.meta?.requireAuth ? (
                    <ProtectedRoute>
                      <Component />
                    </ProtectedRoute>
                  ) : (
                    <Component />
                  )
                }
              />
            )
          })}
          
          {/* 404é¡µé¢ï¼ˆå¿…é¡»æ”¾åœ¨æœ€åï¼‰ */}
          <Route path="*" element={<NotFoundPage />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  )
}

export default App
```

### æ­¥éª¤4: åç«¯Appé›†æˆ

```typescript
// backend/src/index.ts
import express from 'express'
import path from 'path'
import cors from 'cors'
import { ModuleRegistry } from '../../template-config/module.registry'

const app = express()

// ä¸­é—´ä»¶
app.use(cors())
app.use(express.json())

// âš™ï¸ è·¯ç”±ä¼˜å…ˆçº§é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

// 1. å¥åº·æ£€æŸ¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
app.get('/health', (req, res) => {
  res.json({ success: true, status: 'healthy' })
})

// 2. æ ¸å¿ƒAPIè·¯ç”±
app.use('/api/auth', authRoutes)
app.use('/api/feedback', feedbackRoutes)

// 3. åŠ¨æ€æ³¨å†Œæ¨¡å—APIè·¯ç”±
const moduleApiRoutes = ModuleRegistry.getModuleApiRoutes()
moduleApiRoutes.forEach((router, apiPrefix) => {
  console.log(`ğŸ“ æ³¨å†Œæ¨¡å—è·¯ç”±: ${apiPrefix}`)
  app.use(apiPrefix, router)
})

// 4. é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
if (process.env.NODE_ENV === 'production') {
  const frontendPath = path.join(__dirname, 'frontend/dist')
  app.use(express.static(frontendPath))
  
  // 5. SPAè·¯ç”±æ”¯æŒï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰
  app.get('*', (req, res, next) => {
    // APIè·¯ç”±è·³è¿‡
    if (req.path.startsWith('/api') || req.path === '/health') {
      return next()
    }
    // è¿”å›index.htmlï¼Œè®©å‰ç«¯è·¯ç”±æ¥ç®¡
    res.sendFile(path.join(frontendPath, 'index.html'))
  })
}

// å¯åŠ¨æœåŠ¡å™¨
const PORT = process.env.PORT || 3000
app.listen(PORT, () => {
  console.log(`ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ ${PORT}`)
  console.log(`ğŸ“Š å·²åŠ è½½ ${moduleApiRoutes.size} ä¸ªæ¨¡å—`)
})
```

---

## ğŸš¢ éƒ¨ç½²å’ŒéªŒè¯

### æ­¥éª¤1: æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å‰ç«¯å¼€å‘æ¨¡å¼
cd frontend
npm run dev
# è®¿é—®: http://localhost:5173/my-feature

# åç«¯å¼€å‘æ¨¡å¼ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cd backend
npm run dev
# API: http://localhost:3000/api/my-feature
```

### æ­¥éª¤2: æœ¬åœ°æ„å»ºéªŒè¯

```bash
# 1. ç¼–è¯‘TypeScriptï¼ˆåç«¯ï¼‰
cd backend
npm run build

# éªŒè¯ç¼–è¯‘æˆåŠŸ
ls -la dist/
grep "my-feature" dist/index.js

# 2. æ„å»ºå‰ç«¯
cd ../frontend
npm run build

# éªŒè¯æ„å»ºæˆåŠŸ
ls -la dist/
cat dist/index.html | grep "my-feature"

# 3. å¤åˆ¶å‰ç«¯åˆ°åç«¯
cp -r dist ../backend/frontend/
```

### æ­¥éª¤3: Gitæäº¤

```bash
# æäº¤æ‰€æœ‰ä¿®æ”¹
git add modules/my-feature/
git add template-config/module.registry.ts
git add frontend/src/App.tsx
git add backend/src/index.ts
git add backend/dist/

git commit -m "feat: add my-feature module with full frontend and backend integration"
git push origin main
```

### æ­¥éª¤4: VPSéƒ¨ç½²

```bash
# åœ¨VPSä¸Šæ“ä½œ
cd /docker/siteN  # Nä¸ºä½ çš„ç«™ç‚¹ç¼–å·

# 1. å¤‡ä»½é…ç½®
cp backend/.env backend/.env.backup

# 2. æ‹‰å–ä»£ç 
git pull origin main

# 3. æ¢å¤é…ç½®
cp backend/.env.backup backend/.env

# 4. åˆå§‹åŒ–æ•°æ®åº“è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
docker exec postgres_master psql -U admin -d postgres <<EOF
-- æ›¿æ¢TABLE_PREFIXå’ŒSITE_USER
\set TABLE_PREFIX 'site3__'
\set SITE_USER 'site3_user'
\i /path/to/modules/my-feature/database/myfeature_tables.sql
EOF

# 5. ä¸€é”®éƒ¨ç½²
./scripts/one-click-deploy-postgres.sh
```

### æ­¥éª¤5: éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep siteN

# 2. æŸ¥çœ‹æ—¥å¿—
docker logs siteN --tail 50
# åº”è¯¥çœ‹åˆ°ï¼šğŸ“ æ³¨å†Œæ¨¡å—è·¯ç”±: /api/my-feature

# 3. æµ‹è¯•API
curl http://localhost:3000/api/my-feature/public
# é¢„æœŸï¼š{"success":true,"data":[...]}

# 4. æµ‹è¯•å‰ç«¯è·¯ç”±ï¼ˆé€šè¿‡Nginxï¼‰
curl -I https://yourdomain.com/my-feature
# é¢„æœŸï¼šHTTP/1.1 200 OK

# 5. å®Œæ•´åŠŸèƒ½æµ‹è¯•
# è®¿é—®æµè§ˆå™¨ï¼šhttps://yourdomain.com/my-feature
```

---

## ğŸ“š æœ€ä½³å®è·µ

### 1. æ¨¡å—ç‹¬ç«‹æ€§åŸåˆ™

âœ… **DO**:
- æ¨¡å—ä»£ç è‡ªåŒ…å«ï¼Œä¸ä¾èµ–å…¶ä»–æ¨¡å—çš„å†…éƒ¨å®ç°
- é€šè¿‡module.config.tsç»Ÿä¸€é…ç½®
- ä½¿ç”¨æ ‡å‡†åŒ–çš„æ¥å£å’Œç±»å‹
- æ•°æ®åº“è¡¨ä½¿ç”¨æ¨¡å—å‰ç¼€

âŒ **DON'T**:
- ç›´æ¥å¯¼å…¥å…¶ä»–æ¨¡å—çš„å†…éƒ¨ç»„ä»¶
- ç¡¬ç¼–ç æ¨¡å—è·¯å¾„æˆ–APIåœ°å€
- è·¨æ¨¡å—ç›´æ¥æ“ä½œæ•°æ®åº“
- å¾ªç¯ä¾èµ–å…¶ä»–æ¨¡å—

### 2. è·¯ç”±å‘½åè§„èŒƒ

```typescript
// âœ… æ­£ç¡®
const routes = [
  { path: '/user-profile', component: UserProfilePage },
  { path: '/color-analysis', component: ColorAnalysisPage },
  { path: '/my-feature', component: MyFeaturePage }
]

// âŒ é”™è¯¯
const routes = [
  { path: '/userProfile', component: UserProfilePage },  // ä¸ä½¿ç”¨é©¼å³°
  { path: '/Color_Analysis', component: ColorAnalysisPage },  // ä¸ç”¨ä¸‹åˆ’çº¿å’Œå¤§å†™
  { path: '/feature', component: MyFeaturePage }  // å¤ªé€šç”¨ï¼Œå®¹æ˜“å†²çª
]
```

### 3. APIè®¾è®¡è§„èŒƒ

```typescript
// âœ… RESTfulé£æ ¼
GET    /api/my-feature           # åˆ—è¡¨
GET    /api/my-feature/:id       # è¯¦æƒ…
POST   /api/my-feature           # åˆ›å»º
PUT    /api/my-feature/:id       # æ›´æ–°
DELETE /api/my-feature/:id       # åˆ é™¤

// âœ… å“åº”æ ¼å¼ç»Ÿä¸€
{
  "success": true | false,
  "data": any,
  "message": "æ“ä½œç»“æœè¯´æ˜",
  "error": "é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
}
```

### 4. é”™è¯¯å¤„ç†

```typescript
// å‰ç«¯é”™è¯¯å¤„ç†
try {
  const data = await featureService.getData(id)
  // å¤„ç†æˆåŠŸ
} catch (error) {
  if (error.response?.status === 404) {
    // æ•°æ®ä¸å­˜åœ¨
    showNotification('æ•°æ®ä¸å­˜åœ¨', 'error')
  } else if (error.response?.status === 401) {
    // æœªæˆæƒ
    navigate('/login')
  } else {
    // å…¶ä»–é”™è¯¯
    showNotification('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error')
  }
}

// åç«¯é”™è¯¯å¤„ç†
try {
  const data = await myFeatureService.getData(id)
  res.json({ success: true, data })
} catch (error) {
  console.error('Error in getData:', error)
  
  if (error.message === 'æ•°æ®ä¸å­˜åœ¨') {
    res.status(404).json({ success: false, message: error.message })
  } else {
    res.status(500).json({ success: false, message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' })
  }
}
```

### 5. ç±»å‹å®‰å…¨

```typescript
// âœ… å…±äº«ç±»å‹å®šä¹‰
// shared/types/modules.ts
export interface ModuleRoute {
  path: string
  component: () => Promise<any>
  meta?: {
    requireAuth?: boolean
    title?: string
    icon?: string
  }
}

export interface ModuleConfig {
  id: string
  name: string
  version: string
  routes: ModuleRoute[]
  backendRoutes?: any
  apiPrefix: string
  enabled: boolean
}

// å‰ç«¯ä½¿ç”¨
import type { ModuleRoute } from '../../../shared/types/modules'

// åç«¯ä½¿ç”¨
import type { ModuleConfig } from '../../../shared/types/modules'
```

### 6. æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- âœ… ä½¿ç”¨è¡¨å‰ç¼€
CREATE TABLE {TABLE_PREFIX}my_feature_data (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES {TABLE_PREFIX}users(id),
    -- ä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´æˆ³å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- âœ… åˆ›å»ºå¿…è¦çš„ç´¢å¼•
CREATE INDEX idx_{TABLE_PREFIX}myfeature_user ON {TABLE_PREFIX}my_feature_data(user_id);

-- âœ… æˆäºˆæ­£ç¡®çš„æƒé™
GRANT ALL PRIVILEGES ON {TABLE_PREFIX}my_feature_data TO {SITE_USER};
```

### 7. å›½é™…åŒ–æ”¯æŒ

```typescript
// å‰ç«¯ç»„ä»¶
import { useTranslation } from 'react-i18next'

const MyFeaturePage = () => {
  const { t } = useTranslation('myFeature')  // ä½¿ç”¨æ¨¡å—å‘½åç©ºé—´
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
    </div>
  )
}

// i18né…ç½®æ–‡ä»¶
// modules/my-feature/i18n/locales/zh.json
{
  "myFeature": {
    "title": "æˆ‘çš„åŠŸèƒ½",
    "description": "è¿™æ˜¯åŠŸèƒ½æè¿°",
    "actions": {
      "create": "åˆ›å»º",
      "edit": "ç¼–è¾‘",
      "delete": "åˆ é™¤"
    }
  }
}
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ¨¡å—è·¯ç”±404

**ç—‡çŠ¶**ï¼šè®¿é—® `/my-feature` è¿”å›404

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥æ¨¡å—æ˜¯å¦æ³¨å†Œ
cat template-config/module.registry.ts | grep "my-feature"

# 2. æ£€æŸ¥æ¨¡å—æ˜¯å¦æ¿€æ´»
cat template-config/module.registry.ts | grep -A 5 "activeModules"

# 3. æ£€æŸ¥å‰ç«¯æ„å»º
ls -la frontend/dist/assets/*.js | head -5
grep -r "my-feature" frontend/dist/assets/*.js

# 4. æ£€æŸ¥åç«¯è·¯ç”±æ³¨å†Œæ—¥å¿—
docker logs siteN | grep "æ³¨å†Œæ¨¡å—è·¯ç”±"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿æ¨¡å—å·²æ·»åŠ åˆ° `availableModules`
2. ç¡®ä¿æ¨¡å—IDåœ¨ `activeModules` åˆ—è¡¨ä¸­
3. é‡æ–°æ„å»ºå‰ç«¯ï¼š`npm run build`
4. é‡æ–°éƒ¨ç½²ï¼š`./scripts/one-click-deploy.sh`

### é—®é¢˜2: APIè°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**ï¼šå‰ç«¯è°ƒç”¨APIè¿”å›404æˆ–500

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥APIè·¯ç”±æ³¨å†Œ
docker logs siteN | grep "my-feature"

# 2. æµ‹è¯•APIç«¯ç‚¹
docker exec siteN curl http://localhost:3000/api/my-feature/public

# 3. æ£€æŸ¥CORSé…ç½®
docker logs siteN | grep "CORS"

# 4. æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec siteN env | grep -E "(ALLOWED_ORIGINS|DB_)"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `apiPrefix` é…ç½®æ­£ç¡®
2. ç¡®è®¤åç«¯è·¯ç”±å·²å¯¼å‡ºï¼š`export default router`
3. æ£€æŸ¥CORSé…ç½®åŒ…å«å‰ç«¯åŸŸå
4. æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œè¡¨æ˜¯å¦å­˜åœ¨

### é—®é¢˜3: æ•°æ®åº“è¡¨ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼šAPIè°ƒç”¨æŠ¥é”™ "relation does not exist"

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
docker exec postgres_master psql -U admin -d postgres -c "\dt site3__my_feature*"

# 2. æ£€æŸ¥TABLE_PREFIXé…ç½®
docker exec siteN env | grep TABLE_PREFIX

# 3. æ£€æŸ¥SQLè„šæœ¬
cat modules/my-feature/database/myfeature_tables.sql
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ‰‹åŠ¨åˆ›å»ºè¡¨
docker exec postgres_master psql -U admin -d postgres <<EOF
CREATE TABLE site3__my_feature_data (
    id SERIAL PRIMARY KEY,
    -- ... å…¶ä»–å­—æ®µ
);
GRANT ALL PRIVILEGES ON site3__my_feature_data TO site3_user;
EOF
```

### é—®é¢˜4: TypeScriptç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶**ï¼š`npm run build` å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥TypeScripté”™è¯¯
cd backend
npm run build 2>&1 | tee build-error.log

# 2. æ£€æŸ¥ç±»å‹å¯¼å…¥
grep "import.*from" modules/my-feature/backend/**/*.ts
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿®å¤ç±»å‹é”™è¯¯
2. ç¡®ä¿æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
3. æ£€æŸ¥ `tsconfig.json` é…ç½®

### é—®é¢˜5: å‰ç«¯ç»„ä»¶åŠ è½½å¤±è´¥

**ç—‡çŠ¶**ï¼šé¡µé¢æ˜¾ç¤º"åŠ è½½ä¸­"ä½†ä¸æ¸²æŸ“

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
# 2. æ£€æŸ¥ç»„ä»¶è·¯å¾„
ls -la modules/my-feature/frontend/pages/

# 3. æ£€æŸ¥æ‡’åŠ è½½é…ç½®
cat modules/my-feature/module.config.ts | grep "component"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ç»„ä»¶æ­£ç¡®å¯¼å‡ºï¼š`export const MyFeaturePage`
2. æ£€æŸ¥å¯¼å…¥è·¯å¾„ï¼š`./frontend/pages/MyFeaturePage`
3. æ·»åŠ é”™è¯¯è¾¹ç•Œç»„ä»¶æ•è·åŠ è½½é”™è¯¯

---

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

### å¼€å‘å‰æ£€æŸ¥
- [ ] ç¡®å®šæ¨¡å—åç§°ï¼ˆkebab-caseï¼‰
- [ ] åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„
- [ ] å‡†å¤‡æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] è§„åˆ’å‰ç«¯è·¯ç”±è·¯å¾„
- [ ] è§„åˆ’åç«¯APIç«¯ç‚¹

### å¼€å‘ä¸­æ£€æŸ¥
- [ ] å‰ç«¯é¡µé¢ç»„ä»¶å·²åˆ›å»º
- [ ] åç«¯è·¯ç”±å’Œæ§åˆ¶å™¨å·²åˆ›å»º
- [ ] module.config.ts å·²é…ç½®
- [ ] ç±»å‹å®šä¹‰å·²åˆ›å»º
- [ ] å›½é™…åŒ–æ–‡ä»¶å·²æ·»åŠ ï¼ˆå¦‚éœ€è¦ï¼‰

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] TypeScriptç¼–è¯‘æ— é”™è¯¯
- [ ] å‰ç«¯æ„å»ºæˆåŠŸ
- [ ] æ¨¡å—å·²æ³¨å†Œåˆ° ModuleRegistry
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] Gitæäº¤åŒ…å«æ‰€æœ‰æ–‡ä»¶

### éƒ¨ç½²åéªŒè¯
- [ ] å®¹å™¨å¯åŠ¨æˆåŠŸ
- [ ] æ¨¡å—è·¯ç”±å·²æ³¨å†Œï¼ˆæ£€æŸ¥æ—¥å¿—ï¼‰
- [ ] å‰ç«¯è·¯ç”±å¯è®¿é—®
- [ ] APIç«¯ç‚¹æ­£å¸¸å“åº”
- [ ] æ•°æ®åº“æ“ä½œæ­£å¸¸
- [ ] å®Œæ•´åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ğŸ¯ ç¤ºä¾‹æ¨¡å—å‚è€ƒ

### ç®€å•ç¤ºä¾‹æ¨¡å—
å‚è€ƒ `modules/example-simple/` ç›®å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€å°åŒ–çš„æ¨¡å—ç¤ºä¾‹ã€‚

### å®Œæ•´åŠŸèƒ½æ¨¡å—
å‚è€ƒ `modules/color-analysis/` ç›®å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«å®Œæ•´åŠŸèƒ½çš„æ¨¡å—ç¤ºä¾‹ã€‚

### åˆ›å»ºè‡ªå·±çš„æ¨¡å—
```bash
# ä½¿ç”¨è„šæœ¬å¿«é€Ÿåˆ›å»º
./scripts/create-new-module.sh your-module-name

# æ‰‹åŠ¨åˆ›å»º
mkdir -p modules/your-module-name/{frontend/{pages,components},backend/{routes,controllers,services},database}
touch modules/your-module-name/module.config.ts
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº
- ğŸ“– [ç¨‹åºæ¶æ„æ€»ç»“](./ç¨‹åºæ¶æ„æ€»ç»“.md)
- ğŸš€ [VPSéƒ¨ç½²é—®é¢˜å¤„ç†æŒ‡å—](./VPSéƒ¨ç½²é—®é¢˜å¤„ç†æŒ‡å—.md)
- ğŸ—„ï¸ [åº”ç”¨æ¥å…¥PostgreSQLæ€»ç³»ç»ŸæŒ‡å—](./åº”ç”¨æ¥å…¥PostgreSQLæ€»ç³»ç»ŸæŒ‡å—.md)

### å¸¸è§é—®é¢˜
- è·¯ç”±å†²çªï¼šç¡®ä¿è·¯ç”±è·¯å¾„å”¯ä¸€
- API 404ï¼šæ£€æŸ¥apiPrefixå’Œè·¯ç”±æ³¨å†Œ
- æ•°æ®åº“é”™è¯¯ï¼šéªŒè¯TABLE_PREFIXå’Œè¡¨å
- CORSé”™è¯¯ï¼šæ£€æŸ¥ALLOWED_ORIGINSé…ç½®

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-03  
**ç»´æŠ¤è€…**: Template Team  
**é€‚ç”¨æ¶æ„**: å‰åç«¯åˆ†ç¦» (React + Express + PostgreSQL)

**æˆåŠŸæ¡ˆä¾‹**ï¼š
- âœ… color-analysis æ¨¡å—ï¼ˆå®Œæ•´åŠŸèƒ½å‚è€ƒï¼‰
- âœ… example-simple æ¨¡å—ï¼ˆå¿«é€Ÿå…¥é—¨å‚è€ƒï¼‰

---

**éµå¾ªæœ¬æŒ‡å—ï¼Œæ‚¨å¯ä»¥åœ¨15åˆ†é’Ÿå†…å®Œæˆä¸€ä¸ªæ–°åŠŸèƒ½æ¨¡å—çš„æ¥å…¥ï¼** ğŸš€

