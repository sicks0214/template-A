# Template A - å¿«é€Ÿå‘½ä»¤å‚è€ƒ

> å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨  
> **GitHub**: https://github.com/sicks0214/template-A

---

## ğŸ”§ æœ¬åœ°å¼€å‘

### TypeScriptç¼–è¯‘
```bash
cd backend
npm run build
grep "database" dist/config/database.js  # éªŒè¯ç¼–è¯‘
```

### å‰ç«¯å¼€å‘
```bash
cd frontend
npm run dev          # å¼€å‘æœåŠ¡å™¨
npm run build        # ç”Ÿäº§æ„å»º
```

### Gitæ“ä½œ
```bash
git status
git add .
git commit -m "feat: æè¿°"
git push origin main

# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10
```

---

## ğŸš€ VPSéƒ¨ç½²

### é¦–æ¬¡éƒ¨ç½²
```bash
# SSHè¿æ¥
ssh root@YOUR_VPS_IP

# å…‹éš†é¡¹ç›®
cd /docker
git clone https://github.com/sicks0214/template-A.git site5
cd site5

# é…ç½®ç¯å¢ƒ
cp backend/.env.production backend/.env
nano backend/.env

# åˆå§‹åŒ–æ•°æ®åº“
nano database/vps/template-a-init.sql  # ä¿®æ”¹é…ç½®
docker exec -i postgres_master psql -U admin -d postgres < database/vps/template-a-init.sql

# ä¸€é”®éƒ¨ç½²
chmod +x scripts/one-click-deploy-postgres.sh
./scripts/one-click-deploy-postgres.sh
```

### ä»£ç æ›´æ–°
```bash
cd /docker/site5
cp backend/.env backend/.env.backup
git stash && git pull origin main && git stash pop
cp backend/.env.backup backend/.env
./scripts/one-click-deploy-postgres.sh
```

### é…ç½®æ›´æ–°
```bash
cd /docker/site5
nano backend/.env
docker restart site5
docker logs site5 --tail 30
```

---

## ğŸ³ Dockerå‘½ä»¤

### å®¹å™¨ç®¡ç†
```bash
# æŸ¥çœ‹è¿è¡Œå®¹å™¨
docker ps
docker ps | grep site5

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# å¯åŠ¨/åœæ­¢/é‡å¯
docker start site5
docker stop site5
docker restart site5

# åˆ é™¤å®¹å™¨
docker stop site5 && docker rm site5

# æŸ¥çœ‹æ—¥å¿—
docker logs site5
docker logs site5 --tail 50
docker logs site5 -f           # å®æ—¶æ—¥å¿—
docker logs site5 --since 10m  # æœ€è¿‘10åˆ†é’Ÿ
```

### é•œåƒç®¡ç†
```bash
# æŸ¥çœ‹é•œåƒ
docker images | grep site5

# æ„å»ºé•œåƒ
docker build -f backend/Dockerfile.simple -t site5:latest ./backend

# æ— ç¼“å­˜æ„å»º
docker build --no-cache -f backend/Dockerfile.simple -t site5:latest ./backend

# åˆ é™¤é•œåƒ
docker rmi site5:latest

# æ¸…ç†æœªä½¿ç”¨é•œåƒ
docker image prune -a
```

### ç½‘ç»œç®¡ç†
```bash
# æŸ¥çœ‹ç½‘ç»œ
docker network ls
docker network ls | grep -E "(webproxy|shared_net)"

# æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…
docker network inspect shared_net
docker network inspect shared_net | grep site5

# è¿æ¥ç½‘ç»œ
docker network connect shared_net site5
docker network connect webproxy site5

# æ–­å¼€ç½‘ç»œ
docker network disconnect shared_net site5
```

### å®¹å™¨æ“ä½œ
```bash
# è¿›å…¥å®¹å™¨
docker exec -it site5 sh
docker exec -it site5 /bin/bash

# åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
docker exec site5 ls -la
docker exec site5 pwd
docker exec site5 env | grep DB

# æŸ¥çœ‹å®¹å™¨ä¿¡æ¯
docker inspect site5
docker inspect site5 | grep IPAddress
docker inspect site5 | grep -A 10 "Networks"

# å®¹å™¨èµ„æºä½¿ç”¨
docker stats site5
docker stats --no-stream site5
```

---

## ğŸ—„ï¸ PostgreSQLå‘½ä»¤

### è¿æ¥æ•°æ®åº“
```bash
# ä½¿ç”¨adminç”¨æˆ·
docker exec -it postgres_master psql -U admin -d postgres

# ä½¿ç”¨ç«™ç‚¹ç”¨æˆ·
docker exec -it postgres_master psql -U site5_user -d postgres
```

### å¸¸ç”¨psqlå‘½ä»¤
```sql
-- åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
\l

-- åˆ—å‡ºæ‰€æœ‰è¡¨
\dt

-- åˆ—å‡ºç«™ç‚¹è¡¨
\dt myapp_*

-- æŸ¥çœ‹è¡¨ç»“æ„
\d myapp_users

-- åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
\du

-- é€€å‡º
\q
```

### æ•°æ®æŸ¥è¯¢
```bash
# å•è¡Œå‘½ä»¤
docker exec postgres_master psql -U site5_user -d postgres -c "SELECT COUNT(*) FROM myapp_users;"

# æŸ¥çœ‹åé¦ˆæ•°æ®
docker exec postgres_master psql -U site5_user -d postgres -c "
SELECT id, site_id, content, created_at 
FROM unified_feedback 
WHERE site_id='site5' 
ORDER BY created_at DESC 
LIMIT 5;
"

# æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
docker exec postgres_master psql -U site5_user -d postgres -c "
SELECT id, username, email, created_at 
FROM myapp_users 
ORDER BY created_at DESC 
LIMIT 10;
"
```

### æ•°æ®åº“ç»´æŠ¤
```bash
# å¤‡ä»½æ•°æ®åº“
docker exec postgres_master pg_dump -U admin postgres > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
docker exec -i postgres_master psql -U admin postgres < backup.sql

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
docker exec postgres_master psql -U admin -d postgres -c "
SELECT 
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables 
WHERE tablename LIKE 'myapp_%'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
"
```

---

## ğŸ” è¯Šæ–­å‘½ä»¤

### å¥åº·æ£€æŸ¥
```bash
# è·å–å®¹å™¨IP
CONTAINER_IP=$(docker inspect site5 | grep -m1 '"IPAddress"' | cut -d'"' -f4)
echo $CONTAINER_IP

# æµ‹è¯•å¥åº·ç«¯ç‚¹
curl http://$CONTAINER_IP:3000/health
curl -I http://$CONTAINER_IP:3000/health

# ä»å®¹å™¨å†…éƒ¨æµ‹è¯•
docker exec site5 curl -s http://localhost:3000/health

# æµ‹è¯•API
curl http://$CONTAINER_IP:3000/api/health
```

### ç½‘ç»œæµ‹è¯•
```bash
# æµ‹è¯•DNSè§£æ
docker exec site5 ping -c 2 postgres_master
docker exec site5 nslookup postgres_master

# æµ‹è¯•ç«¯å£è¿æ¥
docker exec site5 nc -zv postgres_master 5432
docker exec site5 telnet postgres_master 5432

# æŸ¥çœ‹ç½‘ç»œé…ç½®
docker exec site5 ip addr
docker exec site5 cat /etc/hosts
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥æ‰¾é”™è¯¯
docker logs site5 2>&1 | grep -i error
docker logs site5 2>&1 | grep -i warning

# æŸ¥æ‰¾ç‰¹å®šå†…å®¹
docker logs site5 | grep "æ•°æ®åº“"
docker logs site5 | grep "CORS"
docker logs site5 | grep "PostgreSQL"

# å¯¼å‡ºæ—¥å¿—
docker logs site5 > site5_logs_$(date +%Y%m%d_%H%M%S).log
```

### ç¯å¢ƒå˜é‡æ£€æŸ¥
```bash
# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
docker exec site5 env

# æŸ¥çœ‹ç‰¹å®šç¯å¢ƒå˜é‡
docker exec site5 env | grep DB
docker exec site5 env | grep SITE_ID
docker exec site5 env | grep TABLE_PREFIX
docker exec site5 env | grep ALLOWED_ORIGINS

# åœ¨VPSä¸ŠæŸ¥çœ‹.envæ–‡ä»¶
cat /docker/site5/backend/.env
cat /docker/site5/backend/.env | grep -E "(DB_|SITE_ID|TABLE_PREFIX)"
```

---

## ğŸŒ Nginx Proxy Manager

### è®¿é—®NPM
```bash
# æµè§ˆå™¨è®¿é—®
http://YOUR_VPS_IP:81

# é»˜è®¤è´¦å·
# Email: admin@example.com
# Password: changeme
```

### æŸ¥çœ‹NPMæ—¥å¿—
```bash
docker logs nginx-proxy-manager
docker logs nginx-proxy-manager --tail 100
```

---

## ğŸ“Š ç›‘æ§å‘½ä»¤

### ç³»ç»Ÿèµ„æº
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹å•ä¸ªå®¹å™¨èµ„æº
docker stats site5 --no-stream

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df

# æŸ¥çœ‹Dockerç©ºé—´ä½¿ç”¨
docker system df -v
```

### å®¹å™¨çŠ¶æ€
```bash
# æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¶é—´
docker ps --format "table {{.Names}}\t{{.Status}}"

# æŸ¥çœ‹å®¹å™¨é‡å¯æ¬¡æ•°
docker inspect site5 --format '{{.RestartCount}}'

# æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¶é—´
docker inspect site5 --format '{{.State.StartedAt}}'
```

---

## ğŸ§¹ æ¸…ç†å‘½ä»¤

### å®‰å…¨æ¸…ç†ï¼ˆä»…æ¸…ç†site5ç›¸å…³ï¼‰
```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop site5
docker rm site5

# åˆ é™¤é•œåƒ
docker rmi site5:latest

# æ¸…ç†æ„å»ºç¼“å­˜
docker builder prune
```

### å…¨å±€æ¸…ç†ï¼ˆå±é™©ï¼å½±å“æ‰€æœ‰é¡¹ç›®ï¼‰
```bash
# âš ï¸ ä»…åœ¨ç¡®å®šæ—¶ä½¿ç”¨

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune

# æ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ
docker network prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº
docker system prune -a --volumes
```

---

## ğŸ” å®‰å…¨å‘½ä»¤

### æ–‡ä»¶æƒé™
```bash
# è®¾ç½®.envæ–‡ä»¶æƒé™
chmod 600 /docker/site5/backend/.env

# æŸ¥çœ‹æ–‡ä»¶æƒé™
ls -la /docker/site5/backend/.env
```

### å¯†ç ç”Ÿæˆ
```bash
# ç”Ÿæˆéšæœºå¯†ç 
openssl rand -base64 32

# ç”ŸæˆJWTå¯†é’¥
openssl rand -base64 64
```

---

## ğŸ“ å¿«é€Ÿéƒ¨ç½²è„šæœ¬

### åˆ›å»ºå¿«é€Ÿéƒ¨ç½²åˆ«å
```bash
# åœ¨VPSçš„ ~/.bashrc æˆ– ~/.zshrc ä¸­æ·»åŠ 
alias site5-deploy='cd /docker/site5 && ./scripts/one-click-deploy-postgres.sh'
alias site5-logs='docker logs site5 -f'
alias site5-restart='docker restart site5'
alias site5-status='docker ps | grep site5 && docker stats site5 --no-stream'

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc
```

### ä½¿ç”¨åˆ«å
```bash
site5-deploy   # ä¸€é”®éƒ¨ç½²
site5-logs     # æŸ¥çœ‹æ—¥å¿—
site5-restart  # é‡å¯å®¹å™¨
site5-status   # æŸ¥çœ‹çŠ¶æ€
```

---

## ğŸ¯ å®Œæ•´éƒ¨ç½²æµç¨‹ï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰

### æœ¬åœ°æäº¤
```bash
cd backend && npm run build && cd .. && git add . && git commit -m "update" && git push
```

### VPSéƒ¨ç½²
```bash
cd /docker/site5 && cp backend/.env backend/.env.backup && git stash && git pull && git stash pop && cp backend/.env.backup backend/.env && ./scripts/one-click-deploy-postgres.sh
```

---

**æœ€åæ›´æ–°**: 2024-10-02  
**ç‰ˆæœ¬**: 1.0

